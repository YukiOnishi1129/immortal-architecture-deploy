# ğŸ§ª ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã‚¬ã‚¤ãƒ‰ - ç¾å ´ã§ä½¿ãˆã‚‹å®Ÿè·µçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

> ğŸ’¡ **ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚´ãƒ¼ãƒ«**
> ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆã®åŸºç¤ã‹ã‚‰ã€App Routeræ™‚ä»£ã®ç¾å®Ÿçš„ãªãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã¾ã§ã€
> ã€Œãªãœãã®ãƒ†ã‚¹ãƒˆãŒå¿…è¦ãªã®ã‹ã€ã‚’è…‘ã«è½ã¡ã‚‹ãƒ¬ãƒ™ãƒ«ã§ç†è§£ã™ã‚‹

---

## ğŸ“š ç›®æ¬¡

1. [ãƒ†ã‚¹ãƒˆã®åŸºç¤çŸ¥è­˜](#ãƒ†ã‚¹ãƒˆã®åŸºç¤çŸ¥è­˜)
2. [ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰](#ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰)
3. [App Routeræ™‚ä»£ã®ãƒ†ã‚¹ãƒˆã®é›£ã—ã•](#app-routeræ™‚ä»£ã®ãƒ†ã‚¹ãƒˆã®é›£ã—ã•)
4. [æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥](#æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥)
5. [å„ãƒ†ã‚¹ãƒˆã®å®Ÿè£…ä¾‹](#å„ãƒ†ã‚¹ãƒˆã®å®Ÿè£…ä¾‹)
6. [E2Eãƒ†ã‚¹ãƒˆï¼ˆPlaywright + MSWï¼‰](#e2eãƒ†ã‚¹ãƒˆplaywright--msw)
7. [ã‚ˆãã‚ã‚‹è³ªå•](#ã‚ˆãã‚ã‚‹è³ªå•)

---

## ãƒ†ã‚¹ãƒˆã®åŸºç¤çŸ¥è­˜

### ğŸ¯ ãªãœãƒ†ã‚¹ãƒˆã‚’æ›¸ãã®ã‹ï¼Ÿ

```
ãƒ†ã‚¹ãƒˆãŒãªã„ä¸–ç•Œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ©Ÿèƒ½è¿½åŠ                           â”‚
â”‚    â†“                               â”‚
â”‚  ã€Œå‹•ã„ãŸï¼ã€â†’ æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤         â”‚
â”‚    â†“                               â”‚
â”‚  3æ—¥å¾Œ: ã€Œãªã‚“ã‹ãƒã‚°ã£ã¦ã‚‹...ã€     â”‚
â”‚    â†“                               â”‚
â”‚  åŸå› èª¿æŸ»ã«åŠæ—¥ã€ä¿®æ­£ã«åŠæ—¥         â”‚
â”‚    â†“                               â”‚
â”‚  ã¾ãŸåˆ¥ã®ãƒã‚°ãŒ...ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—ï¼‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ãƒ†ã‚¹ãƒˆãŒã‚ã‚‹ä¸–ç•Œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ©Ÿèƒ½è¿½åŠ                           â”‚
â”‚    â†“                               â”‚
â”‚  ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ â†’ å¤±æ•—ã‚’æ¤œå‡ºï¼          â”‚
â”‚    â†“                               â”‚
â”‚  ä¿®æ­£ â†’ ãƒ†ã‚¹ãƒˆæˆåŠŸ                  â”‚
â”‚    â†“                               â”‚
â”‚  å®‰å¿ƒã—ã¦æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤               â”‚
â”‚    â†“                               â”‚
â”‚  ãƒã‚°æ¿€æ¸›ã€é–‹ç™ºãŒæ¥½ã—ã„ï¼           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ“Š ãƒ†ã‚¹ãƒˆã®ç¨®é¡

| ç¨®é¡ | ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ï¼Ÿ | é€Ÿåº¦ | ä¿¡é ¼æ€§ |
|------|-----------------|------|--------|
| **Unit Test** | é–¢æ•°ãƒ»Hookå˜ä½“ | âš¡ è¶…é€Ÿã„ | é«˜ã„ |
| **Integration Test** | è¤‡æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé€£æº | ğŸš€ ã‚„ã‚„é…ã„ | ä¸­ç¨‹åº¦ |
| **E2E Test** | ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ | ğŸ¢ é…ã„ | ä½ã„ï¼ˆå£Šã‚Œã‚„ã™ã„ï¼‰ |

---

### ğŸ” ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®ç¨®é¡

```
C0ï¼ˆStatement Coverageï¼‰:
  ã™ã¹ã¦ã®ã€Œè¡Œã€ã‚’å®Ÿè¡Œã—ãŸã‹ï¼Ÿ
  â†’ æœ€ä½é™ã®ã‚«ãƒãƒ¬ãƒƒã‚¸

C1ï¼ˆBranch Coverageï¼‰:
  ã™ã¹ã¦ã®ã€Œåˆ†å²ã€ã‚’é€šã£ãŸã‹ï¼Ÿ
  â†’ ifæ–‡ã®true/falseä¸¡æ–¹ã‚’ãƒ†ã‚¹ãƒˆ
  â†’ ç¾å ´ã§æœ€ã‚‚ã‚ˆãä½¿ã†

C2ï¼ˆCondition Coverageï¼‰:
  ã™ã¹ã¦ã®ã€Œæ¡ä»¶ã®çµ„ã¿åˆã‚ã›ã€ã‚’ãƒ†ã‚¹ãƒˆã—ãŸã‹ï¼Ÿ
  â†’ è¤‡é›‘ã™ãã¦ç¾å®Ÿçš„ã§ã¯ãªã„
```

**ä¾‹ï¼šC1ã‚«ãƒãƒ¬ãƒƒã‚¸**

```typescript
function canPublish(note: Note): boolean {
  if (note.status !== 'Draft') {  // â† åˆ†å²1
    return false;
  }
  if (note.sections.length === 0) {  // â† åˆ†å²2
    return false;
  }
  return true;
}

// C1é”æˆã«ã¯æœ€ä½3ã‚±ãƒ¼ã‚¹å¿…è¦:
// 1. status === 'Draft' && sections.length > 0  â†’ true
// 2. status !== 'Draft'                         â†’ åˆ†å²1ã§false
// 3. sections.length === 0                      â†’ åˆ†å²2ã§false
```

---

### ğŸ ãƒ†ã‚¹ãƒˆãŒã‚ã‚‹ã¨ä½•ãŒå¬‰ã—ã„ï¼Ÿ

| ãƒ¡ãƒªãƒƒãƒˆ | å…·ä½“ä¾‹ |
|----------|--------|
| **ãƒ‡ã‚°ãƒ¬é˜²æ­¢** | æ—¢å­˜æ©Ÿèƒ½ãŒå£Šã‚ŒãŸã‚‰å³åº§ã«æ¤œçŸ¥ |
| **ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®å®‰å¿ƒæ„Ÿ** | å‹•ä½œä¿è¨¼ãŒã‚ã‚‹ã‹ã‚‰å¤§èƒ†ã«æ”¹å–„ã§ãã‚‹ |
| **ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ›´æ–°ã®å®‰å…¨æ€§** | React 19ã¸ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§å£Šã‚ŒãŸç®‡æ‰€ã‚’å³ç™ºè¦‹ |
| **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŠ¹æœ** | ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒä»•æ§˜æ›¸ä»£ã‚ã‚Šã«ãªã‚‹ |
| **é–‹ç™ºé€Ÿåº¦å‘ä¸Š** | æ‰‹å‹•ç¢ºèªã®æ™‚é–“ãŒæ¸›ã‚‹ |

---

### ğŸ”„ ç‰¹ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ›´æ–°ã§å¨åŠ›ã‚’ç™ºæ®

```
ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ›´æ–°æ™‚ã®ã‚·ãƒŠãƒªã‚ª:

ãƒ†ã‚¹ãƒˆãªã—:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Next.js 15 â†’ 16 ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ             â”‚
â”‚    â†“                                        â”‚
â”‚  ãƒ“ãƒ«ãƒ‰æˆåŠŸï¼                               â”‚
â”‚    â†“                                        â”‚
â”‚  æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤                               â”‚
â”‚    â†“                                        â”‚
â”‚  ãƒ¦ãƒ¼ã‚¶ãƒ¼:ã€Œæ¤œç´¢æ©Ÿèƒ½ãŒå‹•ã‹ãªã„...ã€         â”‚
â”‚    â†“                                        â”‚
â”‚  åŸå› : useSearchParamsã®æŒ™å‹•ãŒå¤‰ã‚ã£ã¦ã„ãŸ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ãƒ†ã‚¹ãƒˆã‚ã‚Š:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Next.js 15 â†’ 16 ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ             â”‚
â”‚    â†“                                        â”‚
â”‚  ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ                                 â”‚
â”‚    â†“                                        â”‚
â”‚  useNoteList.test.ts: FAILED âŒ             â”‚
â”‚  ã€Œæ¤œç´¢ã‚¯ã‚¨ãƒªã®å–å¾—ãŒå¤±æ•—ã€                 â”‚
â”‚    â†“                                        â”‚
â”‚  ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«å•é¡Œã‚’ç™ºè¦‹ãƒ»ä¿®æ­£ï¼             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰

### ğŸ”º ç†æƒ³çš„ãªãƒ†ã‚¹ãƒˆæ§‹æˆ

```
            â–²
           /E2E\              å°‘ãªã„ï¼ˆ5-10%ï¼‰
          /â”€â”€â”€â”€â”€\             é…ã„ã€å£Šã‚Œã‚„ã™ã„
         /       \            ä¸»è¦ãƒ•ãƒ­ãƒ¼ã®ã¿
        / Integra-\
       /   tion    \          ä¸­ç¨‹åº¦ï¼ˆ20-30%ï¼‰
      /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\         ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé€£æº
     /               \
    /    Unit Test    \       å¤šã„ï¼ˆ60-70%ï¼‰
   /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\      é€Ÿã„ã€å®‰å®š
  /                     \     ãƒ­ã‚¸ãƒƒã‚¯ã®æ¤œè¨¼
```

### ãªãœãƒ”ãƒ©ãƒŸãƒƒãƒ‰å‹ï¼Ÿ

```
âŒ ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ã‚³ãƒ¼ãƒ³å‹ï¼ˆã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰

        â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
       â–“ E2E Test  â–“     â† å¤šã™ãï¼é…ã„ã€å£Šã‚Œã‚„ã™ã„
        â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
           â–“â–“â–“
          â–“ Int â–“         â† å°‘ãªã„
           â–“â–“â–“
            â–“
           â–“Unitâ–“         â† å°‘ãªã™ãï¼
            â–“

å•é¡Œ:
â”œâ”€ E2EãŒå¤šã„ã¨å®Ÿè¡Œæ™‚é–“ãŒé•·ã„ï¼ˆ30åˆ†ä»¥ä¸Šï¼‰
â”œâ”€ ç’°å¢ƒä¾å­˜ã§ä¸å®‰å®šï¼ˆCIå¤±æ•—ãŒé »ç™ºï¼‰
â”œâ”€ ãƒ‡ãƒãƒƒã‚°ãŒå›°é›£ï¼ˆã©ã“ã§å¤±æ•—ã—ãŸã‹ã‚ã‹ã‚‰ãªã„ï¼‰
â””â”€ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆãŒé«˜ã„
```

```
âœ… ãƒ”ãƒ©ãƒŸãƒƒãƒ‰å‹ï¼ˆæ¨å¥¨ï¼‰

            â–²
           /E2E\              â† å°‘æ•°ï¼ˆä¸»è¦ãƒ•ãƒ­ãƒ¼ï¼‰
          /â”€â”€â”€â”€â”€\
         / Integra-\          â† ä¸­ç¨‹åº¦
        /   tion    \
       /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
      /    Unit Test  \       â† å¤šæ•°ï¼ˆé«˜é€Ÿï¼‰
     /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\

ãƒ¡ãƒªãƒƒãƒˆ:
â”œâ”€ å®Ÿè¡Œæ™‚é–“ãŒçŸ­ã„ï¼ˆæ•°åˆ†ï¼‰
â”œâ”€ å®‰å®šã—ã¦ã„ã‚‹ï¼ˆç’°å¢ƒä¾å­˜ãŒå°‘ãªã„ï¼‰
â”œâ”€ ãƒ‡ãƒãƒƒã‚°ã—ã‚„ã™ã„ï¼ˆå¤±æ•—ç®‡æ‰€ãŒæ˜ç¢ºï¼‰
â””â”€ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆãŒä½ã„
```

---

### ğŸ“‹ ä¸€èˆ¬çš„ãªãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆå¯¾è±¡

```
ä¸€èˆ¬çš„ãªãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆæˆ¦ç•¥:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Unit Test                                              â”‚
â”‚  â”œâ”€â”€ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ï¼ˆformatDate, cn ãªã©ï¼‰         â”‚
â”‚  â”œâ”€â”€ ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ï¼ˆuseNoteList ãªã©ï¼‰                â”‚
â”‚  â””â”€â”€ çŠ¶æ…‹ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Integration Test                                       â”‚
â”‚  â”œâ”€â”€ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå˜ä½“ï¼ˆPresenterï¼‰                   â”‚
â”‚  â”œâ”€â”€ ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³                          â”‚
â”‚  â””â”€â”€ APIé€£æºï¼ˆãƒ¢ãƒƒã‚¯ä½¿ç”¨ï¼‰                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  E2E Test                                               â”‚
â”‚  â”œâ”€â”€ ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼                                    â”‚
â”‚  â”œâ”€â”€ CRUDæ“ä½œï¼ˆä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ï¼‰                     â”‚
â”‚  â””â”€â”€ æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## App Routeræ™‚ä»£ã®ãƒ†ã‚¹ãƒˆã®é›£ã—ã•

### ğŸ˜° ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆã®ç¾å®Ÿ

ç†æƒ³é€šã‚Šã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆã‚’æ›¸ã“ã†ã¨ã™ã‚‹ã¨ã€ã„ãã¤ã‹ã®å£ã«ã¶ã¤ã‹ã‚Šã¾ã™ã€‚

---

### èª²é¡Œ1: Server Actionså•é¡Œ

Next.js App Router ã§ã¯ Server Actions ãŒä½¿ã‚ã‚Œã¾ã™ã€‚
Presenterã‹ã‚‰å‘¼ã°ã‚Œã‚‹å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã€å†…éƒ¨ã§Server Actionsã‚’ä½¿ã£ã¦ã„ã‚‹ã¨...

```tsx
// PublicNoteListFilterï¼ˆPresenterã‹ã‚‰å‘¼ã°ã‚Œã‚‹å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰
function PublicNoteListFilter({ filters }: Props) {
  const handleSearch = async (query: string) => {
    // âŒ Server Actionã‚’å†…éƒ¨ã§å‘¼ã‚“ã§ã„ã‚‹
    await searchNotesAction(query);  // â† ãƒ†ã‚¹ãƒˆæ™‚ã«ãƒ¢ãƒƒã‚¯ãŒè¶…å›°é›£
  };

  return <SearchInput onSearch={handleSearch} />;
}
```

```tsx
// NoteListPresenter ã‚’ãƒ†ã‚¹ãƒˆã—ãŸã„ãŒ...
export function NoteListPresenter({ notes, filters }: Props) {
  return (
    <div>
      {/* ã“ã®å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒServer Actionsã‚’ä½¿ã£ã¦ã„ã‚‹ï¼ */}
      <PublicNoteListFilter filters={filters} />
      {/* ... */}
    </div>
  );
}
```

```
å•é¡Œã®æ§‹é€ :

NoteListPresenter (ãƒ†ã‚¹ãƒˆå¯¾è±¡)
    â”‚
    â””â”€â”€ PublicNoteListFilter (å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)
            â”‚
            â””â”€â”€ searchNotesAction (Server Action)
                    â”‚
                    â””â”€â”€ ğŸ”¥ ãƒ†ã‚¹ãƒˆæ™‚ã«ãƒ¢ãƒƒã‚¯ãŒå›°é›£ï¼

ãªãœãƒ¢ãƒƒã‚¯ãŒå›°é›£ï¼Ÿ:
â”œâ”€ Server Actionsã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§å®Ÿè¡Œã•ã‚Œã‚‹
â”œâ”€ 'use server' ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ãŒã‚ã‚‹ã¨Jestã§ãƒ¢ãƒƒã‚¯ä¸å¯
â”œâ”€ next/navigation ã®ãƒ¢ãƒƒã‚¯ã‚‚è¤‡é›‘
â””â”€ å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å†…éƒ¨å®Ÿè£…ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚‹
```

---

### èª²é¡Œ2: Props Drillingåœ°ç„

ã€ŒServer Actionsã‚’è¦ªã‹ã‚‰PropsçµŒç”±ã§æ¸¡ã›ã°ã„ã„ã®ã§ã¯ï¼Ÿã€

```tsx
// ç†è«–ä¸Šã¯ã“ã†ã™ã‚Œã°è§£æ±º...
<PublicNoteListFilter
  filters={filters}
  onSearch={searchNotesAction}  // â† è¦ªã‹ã‚‰æ¸¡ã™
/>
```

**ã—ã‹ã—ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆéšå±¤ãŒæ·±ããªã‚‹ã¨...**

```tsx
// Props drillingåœ°ç„ã®å§‹ã¾ã‚Š
<GrandParent
  onDelete={deleteAction}
  onSearch={searchAction}
  onUpdate={updateAction}
  onPublish={publishAction}
  onUnpublish={unpublishAction}
>
  <Parent
    onDelete={onDelete}
    onSearch={onSearch}
    onUpdate={onUpdate}
    onPublish={onPublish}
    onUnpublish={onUnpublish}
  >
    <Child
      onDelete={onDelete}
      onSearch={onSearch}
      onUpdate={onUpdate}
    >
      <GrandChild onDelete={onDelete} onSearch={onSearch} />
    </Child>
  </Parent>
</GrandParent>
```

```
Props Drillingã®å•é¡Œ:

                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  GrandParent                        â”‚
                   â”‚  props: 5å€‹ã®Server Actions         â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  Parent                             â”‚
                   â”‚  props: 5å€‹ã®Server Actions (å—ã‘æ¸¡ã—)â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  Child                              â”‚
                   â”‚  props: 3å€‹ã®Server Actions         â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  GrandChild                         â”‚
                   â”‚  props: 2å€‹ã®Server Actions         â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çµæœ:
â”œâ”€ Propsã®æ•°ãŒçˆ†ç™ºçš„ã«å¢—ãˆã‚‹
â”œâ”€ å®Ÿè£…ã‚³ã‚¹ãƒˆãŒé«˜ã„
â”œâ”€ å‹å®šç¾©ãŒè¤‡é›‘ã«ãªã‚‹
â””â”€ ãƒ†ã‚¹ãƒˆã®ãŸã‚ã«ã‚³ãƒ¼ãƒ‰ã‚’è¤‡é›‘ã«ã™ã‚‹ã®ã¯æœ¬æœ«è»¢å€’
```

---

### èª²é¡Œ3: UIã¯é »ç¹ã«å¤‰ã‚ã‚‹

```
ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼: ã€Œã“ã®ãƒœã‚¿ãƒ³ã®ä½ç½®ã‚’å¤‰ãˆã¦ã€è‰²ã‚‚å¤‰æ›´ã§ï¼ã€

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆãŒã‚ã‚‹å ´åˆ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UIã‚’å¤‰æ›´                                   â”‚
â”‚    â†“                                        â”‚
â”‚  ãƒ†ã‚¹ãƒˆå¤±æ•—ï¼ˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¸ä¸€è‡´ï¼‰       â”‚
â”‚    â†“                                        â”‚
â”‚  ãƒ†ã‚¹ãƒˆã‚’ä¿®æ­£...                            â”‚
â”‚    â†“                                        â”‚
â”‚  ã¾ãŸå¤‰æ›´ä¾é ¼                               â”‚
â”‚    â†“                                        â”‚
â”‚  ã¾ãŸãƒ†ã‚¹ãƒˆä¿®æ­£...ï¼ˆä»¥ä¸‹ãƒ«ãƒ¼ãƒ—ï¼‰            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çµæœ: ãƒ†ã‚¹ãƒˆã®ç¶­æŒã‚³ã‚¹ãƒˆãŒé«˜ã™ãã¦ã€ãƒ†ã‚¹ãƒˆã‚’æ¶ˆã™ã‹æ”¾ç½®ã•ã‚Œã‚‹
```

---

### ğŸ¤” ã˜ã‚ƒã‚ã©ã†ã™ã‚‹ï¼Ÿ

```
ç¾å®Ÿçš„ãªçµè«–:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  Presenterã®ãƒ†ã‚¹ãƒˆã¯ã€Œã‚³ã‚¹ãƒ‘ãŒæ‚ªã„ã€                    â”‚
â”‚                                                         â”‚
â”‚  â”œâ”€â”€ Server Actionså•é¡Œ â†’ ãƒ¢ãƒƒã‚¯ãŒè¤‡é›‘ã™ãã‚‹           â”‚
â”‚  â”œâ”€â”€ Props Drilling â†’ å®Ÿè£…ã‚³ã‚¹ãƒˆãŒé«˜ã„                 â”‚
â”‚  â””â”€â”€ UIå¤‰æ›´é »åº¦ â†’ ç¶­æŒã‚³ã‚¹ãƒˆãŒé«˜ã„                     â”‚
â”‚                                                         â”‚
â”‚  â†’ ãƒ†ã‚¹ãƒˆã™ã¹ãå ´æ‰€ã‚’ã€Œçµã‚‹ã€ã®ãŒç¾å®Ÿçš„                â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ğŸ—ï¸ ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥ãƒ†ã‚¹ãƒˆæ–¹é‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ ãƒ†ã‚¹ãƒˆæˆ¦ç•¥                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Unit Testï¼ˆVitestï¼‰                                     â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  ã‚«ã‚¹ã‚¿ãƒ Hook     âœ… å¿…é ˆ   ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®æ ¸å¿ƒ      â”‚   â”‚
â”‚  â”‚  Query Keys       âœ… å¿…é ˆ   ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ã®è¦          â”‚   â”‚
â”‚  â”‚  Utils            âœ… æ¨å¥¨   ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  E2E Testï¼ˆPlaywright + MSWï¼‰                            â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  ä¸»è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼   âœ… å¿…é ˆ   ä¸€è¦§è¡¨ç¤ºã€ä½œæˆã€ç·¨é›†     â”‚   â”‚
â”‚  â”‚  ç”»é¢é–“ã®é·ç§»         âœ… å¿…é ˆ   ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç¢ºèª         â”‚   â”‚
â”‚  â”‚  ã‚¨ãƒ©ãƒ¼è¡¨ç¤º           âœ… æ¨å¥¨   ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚
â”‚    Presenter / Container ã¯ç›´æ¥ãƒ†ã‚¹ãƒˆã—ãªã„                     â”‚
â”‚    ï¼ˆE2Eã§ã‚«ãƒãƒ¼ï¼‰                                              â”‚
â”‚                                                                 â”‚
â”‚  â€» externalå±¤ï¼ˆDTO, Service, Handlerï¼‰ã®ãƒ†ã‚¹ãƒˆã¯              â”‚
â”‚    BFFãƒ†ã‚¹ãƒˆæˆ¦ç•¥ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Š ã¾ã¨ã‚è¡¨

| å¯¾è±¡ | Unit Test | E2E | ãƒ†ã‚¹ãƒˆå†…å®¹ |
|------|-----------|-----|-----------|
| **ã‚«ã‚¹ã‚¿ãƒ Hook** | âœ… å¿…é ˆ | - | ãƒ­ã‚¸ãƒƒã‚¯ã€çŠ¶æ…‹ç®¡ç† |
| **Query Keys** | âœ… å¿…é ˆ | - | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã®æ­£ã—ã• |
| **Utils** | âœ… æ¨å¥¨ | - | ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•° |
| **Presenter** | âŒ | E2Eã§ã‚«ãƒãƒ¼ | Server Actionså•é¡Œ |
| **Container** | âŒ | E2Eã§ã‚«ãƒãƒ¼ | Hookãƒ†ã‚¹ãƒˆã§ååˆ† |
| **ä¸»è¦ãƒ•ãƒ­ãƒ¼** | - | âœ… å¿…é ˆ | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ |

> ğŸ“ **Note**: externalå±¤ï¼ˆDTO, Service, Handlerï¼‰ã®ãƒ†ã‚¹ãƒˆã¯ [BFFãƒ†ã‚¹ãƒˆæˆ¦ç•¥](./10_bff_testing_strategy.md) ã‚’å‚ç…§

---

### ğŸ¯ ã“ã®æˆ¦ç•¥ã§é”æˆã§ãã‚‹ã“ã¨

| ç›®çš„ | ã©ã®ãƒ†ã‚¹ãƒˆã§ã‚«ãƒãƒ¼ï¼Ÿ |
|------|---------------------|
| **ãƒ‡ã‚°ãƒ¬é˜²æ­¢** | Hook ãƒ†ã‚¹ãƒˆ |
| **ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ›´æ–°ã®å®‰å…¨æ€§** | Hook / Query Keys ãƒ†ã‚¹ãƒˆ |
| **UIã®å‹•ä½œä¿è¨¼** | E2Eãƒ†ã‚¹ãƒˆ |

> ğŸ“ **Note**: APIã¨ã®å¥‘ç´„ç¢ºèªã¯ [BFFãƒ†ã‚¹ãƒˆæˆ¦ç•¥](./10_bff_testing_strategy.md) ã‚’å‚ç…§

---

### ğŸ“ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã¨ãƒ†ã‚¹ãƒˆãƒã‚¤ãƒ³ãƒˆ

```
Page (Server Component)
  â””â”€â”€ PageTemplate (Server Component)
        â””â”€â”€ Container (Client Component)
              â””â”€â”€ useXxx Hook â† â˜… ãƒ†ã‚¹ãƒˆãƒã‚¤ãƒ³ãƒˆ
                    â””â”€â”€ useXxxQuery (TanStack Query)
                          â””â”€â”€ Server Action â† BFFãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã¸
                                â””â”€â”€ Service  â† BFFãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã¸
              â””â”€â”€ Presenter (View) â† E2Eã§ã‚«ãƒãƒ¼
```

---

## å„ãƒ†ã‚¹ãƒˆã®å®Ÿè£…ä¾‹

### ğŸ—ï¸ æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆãŠã•ã‚‰ã„ï¼‰

```
features/note/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ server/          # Server Componentsï¼ˆãƒ—ãƒªãƒ•ã‚§ãƒƒãƒæ‹…å½“ï¼‰
â”‚   â”‚   â””â”€â”€ NoteListPageTemplate/
â”‚   â””â”€â”€ client/          # Client Components
â”‚       â””â”€â”€ NoteList/
â”‚           â”œâ”€â”€ NoteListContainer.tsx    # ãƒ­ã‚¸ãƒƒã‚¯å±¤
â”‚           â”œâ”€â”€ NoteListPresenter.tsx    # è¡¨ç¤ºå±¤ï¼ˆãƒ†ã‚¹ãƒˆã—ãªã„ï¼‰
â”‚           â””â”€â”€ useNoteList.ts           # ã‚«ã‚¹ã‚¿ãƒ Hook â† â˜…ãƒ†ã‚¹ãƒˆå¯¾è±¡
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useNoteListQuery.ts              # TanStack Query â† â˜…ãƒ†ã‚¹ãƒˆå¯¾è±¡
â””â”€â”€ queries/
    â””â”€â”€ keys.ts                          # Query Keys â† â˜…ãƒ†ã‚¹ãƒˆå¯¾è±¡
```

---

### 1ï¸âƒ£ ã‚«ã‚¹ã‚¿ãƒ Hookã®ãƒ†ã‚¹ãƒˆ

**ç›®çš„**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‹æ¤œè¨¼

**ç‰¹å¾´**:
- å¤–éƒ¨ä¾å­˜ã¯ãƒ¢ãƒƒã‚¯ã§å·®ã—æ›¿ãˆ
- UIã«ä¾å­˜ã—ãªã„
- è¶…é«˜é€Ÿ

**ãƒ†ã‚¹ãƒˆå¯¾è±¡**: `useNoteList.ts`

```typescript
// features/note/components/client/NoteList/useNoteList.ts
export function useNoteList(initialFilters: NoteFilters = {}) {
  const searchParams = useSearchParams();
  const pageParam = searchParams.get("page");

  const filters: NoteFilters = {
    q: searchParams.get("q") || initialFilters.q,
    status: NOTE_STATUS.PUBLISH,
    page: pageParam ? Number.parseInt(pageParam, 10) : initialFilters.page || 1,
  };

  const { data: notes, isLoading } = useNoteListQuery(filters);

  return {
    notes: notes || [],
    isLoading,
    filters,
  };
}
```

**ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰**:

```typescript
// features/note/components/client/NoteList/useNoteList.test.ts
import { renderHook } from '@testing-library/react';
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { useNoteList } from './useNoteList';

// ä¾å­˜é–¢ä¿‚ã‚’ãƒ¢ãƒƒã‚¯
vi.mock('@/features/note/hooks/useNoteListQuery', () => ({
  useNoteListQuery: vi.fn(),
}));

vi.mock('next/navigation', () => ({
  useSearchParams: vi.fn(() => ({
    get: vi.fn((key: string) => null),
  })),
}));

import { useNoteListQuery } from '@/features/note/hooks/useNoteListQuery';
import { useSearchParams } from 'next/navigation';

describe('useNoteList', () => {
  beforeEach(() => {
    vi.clearAllMocks();
  });

  it('å¸¸ã«Publishã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ãƒ•ã‚£ãƒ«ã‚¿ã™ã‚‹', () => {
    // Arrange
    vi.mocked(useNoteListQuery).mockReturnValue({
      data: [],
      isLoading: false,
    } as any);

    // Act
    const { result } = renderHook(() => useNoteList());

    // Assert
    expect(result.current.filters.status).toBe('Publish');
  });

  it('URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒšãƒ¼ã‚¸ç•ªå·ã‚’å–å¾—ã™ã‚‹', () => {
    // Arrange
    vi.mocked(useSearchParams).mockReturnValue({
      get: vi.fn((key: string) => key === 'page' ? '3' : null),
    } as any);
    vi.mocked(useNoteListQuery).mockReturnValue({
      data: [],
      isLoading: false,
    } as any);

    // Act
    const { result } = renderHook(() => useNoteList());

    // Assert
    expect(result.current.filters.page).toBe(3);
  });

  it('ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ã¯isLoadingãŒtrueã€notesã¯ç©ºé…åˆ—', () => {
    // Arrange
    vi.mocked(useNoteListQuery).mockReturnValue({
      data: undefined,
      isLoading: true,
    } as any);

    // Act
    const { result } = renderHook(() => useNoteList());

    // Assert
    expect(result.current.isLoading).toBe(true);
    expect(result.current.notes).toEqual([]);
  });
});
```

**ã“ã®ãƒ†ã‚¹ãƒˆã§å®ˆã‚Œã‚‹ã‚‚ã®**:
- Next.js ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã§ `useSearchParams` ã®æŒ™å‹•ãŒå¤‰ã‚ã£ãŸ â†’ ãƒ†ã‚¹ãƒˆã§æ¤œçŸ¥
- ãƒ•ã‚£ãƒ«ã‚¿ãƒ­ã‚¸ãƒƒã‚¯ã®èª¤ã£ãŸå¤‰æ›´ â†’ ãƒ†ã‚¹ãƒˆã§æ¤œçŸ¥

---

### 2ï¸âƒ£ Query Keysã®ãƒ†ã‚¹ãƒˆ

**ç›®çš„**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ãŒæ­£ã—ãç”Ÿæˆã•ã‚Œã‚‹ã‹æ¤œè¨¼

**ç‰¹å¾´**:
- ç´”ç²‹é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ
- ãƒ¢ãƒƒã‚¯ä¸è¦
- è¶…é«˜é€Ÿ

**ãƒ†ã‚¹ãƒˆå¯¾è±¡**: `keys.ts`

```typescript
// features/note/queries/keys.ts
export const noteKeys = {
  all: ["notes"] as const,
  lists: () => [...noteKeys.all, "list"] as const,
  list: (filters: NoteFilters) => [...noteKeys.lists(), filters] as const,
  details: () => [...noteKeys.all, "detail"] as const,
  detail: (id: string) => [...noteKeys.details(), id] as const,
};
```

**ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰**:

```typescript
// features/note/queries/keys.test.ts
import { describe, it, expect } from 'vitest';
import { noteKeys } from './keys';

describe('noteKeys', () => {
  it('all ã¯ ["notes"] ã‚’è¿”ã™', () => {
    expect(noteKeys.all).toEqual(['notes']);
  });

  it('lists ã¯ ["notes", "list"] ã‚’è¿”ã™', () => {
    expect(noteKeys.lists()).toEqual(['notes', 'list']);
  });

  it('list ã¯ãƒ•ã‚£ãƒ«ã‚¿ã‚’å«ã‚€ã‚­ãƒ¼ã‚’è¿”ã™', () => {
    const filters = { status: 'Publish' as const, page: 1 };

    expect(noteKeys.list(filters)).toEqual([
      'notes',
      'list',
      { status: 'Publish', page: 1 }
    ]);
  });

  it('ç•°ãªã‚‹ãƒ•ã‚£ãƒ«ã‚¿ã¯ç•°ãªã‚‹ã‚­ãƒ¼ã‚’ç”Ÿæˆã™ã‚‹', () => {
    const key1 = noteKeys.list({ status: 'Publish' as const });
    const key2 = noteKeys.list({ status: 'Draft' as const });

    expect(key1).not.toEqual(key2);
  });
});
```

**ã“ã®ãƒ†ã‚¹ãƒˆã§å®ˆã‚Œã‚‹ã‚‚ã®**:
- ã‚­ãƒ¼ã®èª¤ã£ãŸå¤‰æ›´ã«ã‚ˆã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥å•é¡Œ â†’ ãƒ†ã‚¹ãƒˆã§æ¤œçŸ¥
- TanStack Query ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ— â†’ ãƒ†ã‚¹ãƒˆã§æ¤œçŸ¥

---

## E2Eãƒ†ã‚¹ãƒˆï¼ˆPlaywright + MSWï¼‰

### ãªãœMSWã‚’ä½¿ã†ã®ã‹ï¼Ÿ

| æ–¹å¼ | ãƒ¡ãƒªãƒƒãƒˆ | ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ |
|------|----------|------------|
| **å®ŸAPIï¼ˆDockerï¼‰** | å®Œå…¨ãªE2E | CIæ™‚é–“ãŒé•·ã„ã€ç’°å¢ƒæ§‹ç¯‰ãŒè¤‡é›‘ |
| **MSW** | é«˜é€Ÿã€ç’°å¢ƒä¸è¦ | ãƒ¢ãƒƒã‚¯ã¨å®ŸAPIã®ä¹–é›¢ãƒªã‚¹ã‚¯ |

**CIã§ã¯MSWã‚’ä½¿ç”¨ã—ã€é«˜é€Ÿã«ãƒ†ã‚¹ãƒˆã‚’å›ã™æˆ¦ç•¥ã‚’æ¡ç”¨**

---

### E2Eãƒ†ã‚¹ãƒˆä¾‹

```typescript
// e2e/note-list.spec.ts
import { test, expect } from '@playwright/test';

test.describe('ãƒãƒ¼ãƒˆä¸€è¦§ãƒšãƒ¼ã‚¸', () => {
  test.beforeEach(async ({ page }) => {
    // MSWã§APIã‚’ãƒ¢ãƒƒã‚¯
    await page.route('**/api/notes*', async (route) => {
      await route.fulfill({
        status: 200,
        contentType: 'application/json',
        body: JSON.stringify([
          {
            id: 'note-1',
            title: 'ãƒ†ã‚¹ãƒˆãƒãƒ¼ãƒˆ1',
            status: 'Publish',
            templateName: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆA',
            owner: {
              id: 'owner-1',
              firstName: 'å¤ªéƒ',
              lastName: 'å±±ç”°',
              thumbnail: null
            },
            createdAt: '2024-01-01T00:00:00Z',
            updatedAt: '2024-01-01T00:00:00Z',
          },
        ]),
      });
    });
  });

  test('ãƒãƒ¼ãƒˆä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
    await page.goto('/notes');

    // ãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    await expect(page.getByText('ãƒ†ã‚¹ãƒˆãƒãƒ¼ãƒˆ1')).toBeVisible();
    await expect(page.getByText('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆA')).toBeVisible();
  });

  test('ãƒãƒ¼ãƒˆãŒãªã„å ´åˆã¯ç©ºçŠ¶æ…‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
    // ç©ºã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã‚ˆã†ã«ãƒ¢ãƒƒã‚¯
    await page.route('**/api/notes*', async (route) => {
      await route.fulfill({
        status: 200,
        contentType: 'application/json',
        body: JSON.stringify([]),
      });
    });

    await page.goto('/notes');

    await expect(page.getByText('ãƒãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“')).toBeVisible();
  });

  test('ãƒãƒ¼ãƒˆè©³ç´°ãƒšãƒ¼ã‚¸ã«é·ç§»ã§ãã‚‹', async ({ page }) => {
    await page.goto('/notes');

    // ãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯
    await page.getByText('ãƒ†ã‚¹ãƒˆãƒãƒ¼ãƒˆ1').click();

    // è©³ç´°ãƒšãƒ¼ã‚¸ã«é·ç§»
    await expect(page).toHaveURL(/\/notes\/note-1/);
  });
});
```

**E2Eãƒ†ã‚¹ãƒˆã§ã‚«ãƒãƒ¼ã™ã‚‹ã‚‚ã®**:
- ä¸»è¦ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼ï¼ˆä¸€è¦§è¡¨ç¤ºã€è©³ç´°é·ç§»ã€ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ï¼‰
- ç”»é¢é–“ã®é·ç§»
- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

---

## ğŸ“ ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®

### ã‚³ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆåŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ï¼‰

```
src/
â”œâ”€â”€ features/
â”‚   â””â”€â”€ note/
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â””â”€â”€ client/
â”‚       â”‚       â””â”€â”€ NoteList/
â”‚       â”‚           â”œâ”€â”€ useNoteList.ts
â”‚       â”‚           â””â”€â”€ useNoteList.test.ts    # â† ã‚³ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚       â”œâ”€â”€ hooks/
â”‚       â”‚   â”œâ”€â”€ useNoteListQuery.ts
â”‚       â”‚   â””â”€â”€ useNoteListQuery.test.ts       # â† ã‚³ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚       â””â”€â”€ queries/
â”‚           â”œâ”€â”€ keys.ts
â”‚           â””â”€â”€ keys.test.ts                   # â† ã‚³ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ shared/
â”‚   â””â”€â”€ lib/
â”‚       â”œâ”€â”€ utils.ts
â”‚       â””â”€â”€ utils.test.ts                      # â† ã‚³ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â””â”€â”€ e2e/                                       # E2Eã¯åˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
    â”œâ”€â”€ note-list.spec.ts
    â””â”€â”€ note-detail.spec.ts
```

> ğŸ“ **Note**: externalå±¤ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ã¯ [BFFãƒ†ã‚¹ãƒˆæˆ¦ç•¥](./10_bff_testing_strategy.md) ã‚’å‚ç…§

---

## ã‚ˆãã‚ã‚‹è³ªå•

### Q1: ãªãœPresenterã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ã‹ãªã„ã®ã‹ï¼Ÿ

**A: ã‚³ã‚¹ãƒ‘ãŒæ‚ªã„ã‹ã‚‰ã§ã™ã€‚**

```
Presenterãƒ†ã‚¹ãƒˆã®å•é¡Œ:

1. Server Actionså•é¡Œ
   â””â”€ å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã®Server Actionsã‚’ãƒ¢ãƒƒã‚¯ã™ã‚‹ã®ãŒå›°é›£

2. Props Drilling
   â””â”€ ãƒ†ã‚¹ãƒˆã®ãŸã‚ã«å®Ÿè£…ã‚’è¤‡é›‘ã«ã™ã‚‹ã®ã¯æœ¬æœ«è»¢å€’

3. UIå¤‰æ›´é »åº¦
   â””â”€ ãƒ‡ã‚¶ã‚¤ãƒ³å¤‰æ›´ã®ãŸã³ã«ãƒ†ã‚¹ãƒˆä¿®æ­£ãŒå¿…è¦

4. E2Eã§ã‚«ãƒãƒ¼å¯èƒ½
   â””â”€ å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹æ–¹ãŒåŠ¹æœçš„
```

---

### Q2: Unit Testã¨E2E Testã®ä½¿ã„åˆ†ã‘ã¯ï¼Ÿ

**A: ã€Œä½•ã‚’æ¤œè¨¼ã—ãŸã„ã‹ã€ã§æ±ºã‚ã¾ã™ã€‚**

```
ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ¤œè¨¼ã—ãŸã„:
  â†’ Unit Testï¼ˆHook / Serviceï¼‰
  â†’ é€Ÿã„ã€å®‰å®šã€ãƒ‡ãƒãƒƒã‚°ã—ã‚„ã™ã„

ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‚’æ¤œè¨¼ã—ãŸã„:
  â†’ E2E Testï¼ˆPlaywrightï¼‰
  â†’ å®Ÿéš›ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª
```

---

### Q3: ãƒ†ã‚¹ãƒˆãŒé…ã„ã¨ãã¯ã©ã†ã™ã‚‹ï¼Ÿ

**A: ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚**

```
1. E2Eãƒ†ã‚¹ãƒˆã‚’æ¸›ã‚‰ã™
   â†’ ä¸»è¦ãƒ•ãƒ­ãƒ¼ã®ã¿ã«çµã‚‹

2. ä¸¦åˆ—å®Ÿè¡Œ
   â†’ Vitestã® --parallel ã‚ªãƒ—ã‚·ãƒ§ãƒ³

3. ãƒ¢ãƒƒã‚¯ã‚’æ´»ç”¨
   â†’ MSWã§APIã‚’ãƒ¢ãƒƒã‚¯

4. ãƒ†ã‚¹ãƒˆã®ç²’åº¦ã‚’è¦‹ç›´ã™
   â†’ Unit Testã‚’å¢—ã‚„ã—ã¦E2Eã‚’æ¸›ã‚‰ã™
```

---

### Q4: TanStack Queryã®ãƒ†ã‚¹ãƒˆã¯ã©ã†æ›¸ãï¼Ÿ

**A: Hookã‚’ãƒ©ãƒƒãƒ—ã—ã¦ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚**

```typescript
// useNoteListQuery ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹å ´åˆ
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { renderHook, waitFor } from '@testing-library/react';

const createWrapper = () => {
  const queryClient = new QueryClient({
    defaultOptions: {
      queries: { retry: false },
    },
  });
  return ({ children }) => (
    <QueryClientProvider client={queryClient}>
      {children}
    </QueryClientProvider>
  );
};

test('ãƒãƒ¼ãƒˆä¸€è¦§ã‚’å–å¾—ã™ã‚‹', async () => {
  const { result } = renderHook(
    () => useNoteListQuery({ status: 'Publish' }),
    { wrapper: createWrapper() }
  );

  await waitFor(() => expect(result.current.isSuccess).toBe(true));
  expect(result.current.data).toHaveLength(2);
});
```

---

## ğŸš€ å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

```bash
# Unit ãƒ†ã‚¹ãƒˆ
pnpm test           # å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm test:watch     # ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰
pnpm test:coverage  # ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ã

# E2Eãƒ†ã‚¹ãƒˆ
pnpm e2e            # Playwrightãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm e2e:ui         # UIãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
```

---

## ã¾ã¨ã‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  âœ… ãƒ†ã‚¹ãƒˆã™ã‚‹                                              â”‚
â”‚  â”œâ”€â”€ ã‚«ã‚¹ã‚¿ãƒ Hook â†’ ãƒ‡ã‚°ãƒ¬é˜²æ­¢ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ›´æ–°ã®å®‰å…¨ç¶²     â”‚
â”‚  â”œâ”€â”€ Query Keys â†’ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ã®è¦                       â”‚
â”‚  â”œâ”€â”€ Utils â†’ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°                            â”‚
â”‚  â””â”€â”€ E2E (Playwright) â†’ UIã®å‹•ä½œä¿è¨¼                       â”‚
â”‚                                                             â”‚
â”‚  âŒ ãƒ†ã‚¹ãƒˆã—ãªã„                                            â”‚
â”‚  â”œâ”€â”€ Presenter â†’ Server Actionså•é¡Œã€ã‚³ã‚¹ãƒ‘æ‚ªã„            â”‚
â”‚  â””â”€â”€ Container â†’ Hookãƒ†ã‚¹ãƒˆã§ã‚«ãƒãƒ¼                        â”‚
â”‚                                                             â”‚
â”‚  â€» externalå±¤ã®ãƒ†ã‚¹ãƒˆã¯ BFFãƒ†ã‚¹ãƒˆæˆ¦ç•¥ ã‚’å‚ç…§              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

- [Vitest å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://vitest.dev/)
- [Testing Library](https://testing-library.com/)
- [MSW (Mock Service Worker)](https://mswjs.io/)
- [Playwright](https://playwright.dev/)
