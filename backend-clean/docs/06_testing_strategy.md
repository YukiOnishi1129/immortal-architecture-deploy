# ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã‚¬ã‚¤ãƒ‰ - ç¾å ´ã§ä½¿ãˆã‚‹å®Ÿè·µçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

> ğŸ’¡ **ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚´ãƒ¼ãƒ«**
> ãƒ†ã‚¹ãƒˆã®åŸºç¤ã‹ã‚‰ã€Clean Architectureã§ã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã¾ã§ã€
> ã€Œãªãœãã®ãƒ†ã‚¹ãƒˆãŒå¿…è¦ãªã®ã‹ã€ã‚’è…‘ã«è½ã¡ã‚‹ãƒ¬ãƒ™ãƒ«ã§ç†è§£ã™ã‚‹

---

## ğŸ“š ç›®æ¬¡

1. [ãƒ†ã‚¹ãƒˆã®åŸºç¤çŸ¥è­˜](#ãƒ†ã‚¹ãƒˆã®åŸºç¤çŸ¥è­˜)
2. [ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰](#ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰)
3. [Clean Architectureã§ã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥](#clean-architectureã§ã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥)
4. [å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ†ã‚¹ãƒˆè©³ç´°](#å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ†ã‚¹ãƒˆè©³ç´°)
5. [testcontainers-goã®ä½¿ã„æ–¹](#testcontainers-goã®ä½¿ã„æ–¹)
6. [ã‚ˆãã‚ã‚‹è³ªå•](#ã‚ˆãã‚ã‚‹è³ªå•)

---

## ãƒ†ã‚¹ãƒˆã®åŸºç¤çŸ¥è­˜

### ğŸ¯ ãªãœãƒ†ã‚¹ãƒˆã‚’æ›¸ãã®ã‹ï¼Ÿ

```
ãƒ†ã‚¹ãƒˆãŒãªã„ä¸–ç•Œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ©Ÿèƒ½è¿½åŠ                           â”‚
â”‚    â†“                               â”‚
â”‚  ã€Œå‹•ã„ãŸï¼ã€â†’ æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤         â”‚
â”‚    â†“                               â”‚
â”‚  3æ—¥å¾Œ: ã€Œãªã‚“ã‹ãƒã‚°ã£ã¦ã‚‹...ã€     â”‚
â”‚    â†“                               â”‚
â”‚  åŸå› èª¿æŸ»ã«åŠæ—¥ã€ä¿®æ­£ã«åŠæ—¥         â”‚
â”‚    â†“                               â”‚
â”‚  ã¾ãŸåˆ¥ã®ãƒã‚°ãŒ...ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—ï¼‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ãƒ†ã‚¹ãƒˆãŒã‚ã‚‹ä¸–ç•Œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ©Ÿèƒ½è¿½åŠ                           â”‚
â”‚    â†“                               â”‚
â”‚  ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ â†’ å¤±æ•—ã‚’æ¤œå‡ºï¼          â”‚
â”‚    â†“                               â”‚
â”‚  ä¿®æ­£ â†’ ãƒ†ã‚¹ãƒˆæˆåŠŸ                  â”‚
â”‚    â†“                               â”‚
â”‚  å®‰å¿ƒã—ã¦æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤               â”‚
â”‚    â†“                               â”‚
â”‚  ãƒã‚°æ¿€æ¸›ã€é–‹ç™ºãŒæ¥½ã—ã„ï¼           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ“Š ãƒ†ã‚¹ãƒˆã®ç¨®é¡

| ç¨®é¡ | ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ï¼Ÿ | é€Ÿåº¦ | ä¿¡é ¼æ€§ |
|------|-----------------|------|--------|
| **Unit Test** | é–¢æ•°ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰å˜ä½“ | âš¡ è¶…é€Ÿã„ | é«˜ã„ |
| **Integration Test** | è¤‡æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé€£æº | ğŸš€ ã‚„ã‚„é…ã„ | ä¸­ç¨‹åº¦ |
| **E2E Test** | ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ | ğŸ¢ é…ã„ | ä½ã„ï¼ˆå£Šã‚Œã‚„ã™ã„ï¼‰ |

---

### ğŸ” ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®ç¨®é¡

```
C0ï¼ˆStatement Coverageï¼‰:
  ã™ã¹ã¦ã®ã€Œè¡Œã€ã‚’å®Ÿè¡Œã—ãŸã‹ï¼Ÿ
  â†’ æœ€ä½é™ã®ã‚«ãƒãƒ¬ãƒƒã‚¸

C1ï¼ˆBranch Coverageï¼‰:
  ã™ã¹ã¦ã®ã€Œåˆ†å²ã€ã‚’é€šã£ãŸã‹ï¼Ÿ
  â†’ ifæ–‡ã®true/falseä¸¡æ–¹ã‚’ãƒ†ã‚¹ãƒˆ
  â†’ ç¾å ´ã§æœ€ã‚‚ã‚ˆãä½¿ã†

C2ï¼ˆCondition Coverageï¼‰:
  ã™ã¹ã¦ã®ã€Œæ¡ä»¶ã®çµ„ã¿åˆã‚ã›ã€ã‚’ãƒ†ã‚¹ãƒˆã—ãŸã‹ï¼Ÿ
  â†’ è¤‡é›‘ã™ãã¦ç¾å®Ÿçš„ã§ã¯ãªã„
```

**ä¾‹ï¼šC1ã‚«ãƒãƒ¬ãƒƒã‚¸**

```go
func CanPublish(note Note) error {
    if note.Status != StatusDraft {  // â† åˆ†å²1
        return ErrInvalidStatus
    }
    if len(note.Sections) == 0 {     // â† åˆ†å²2
        return ErrNoSections
    }
    return nil
}

// C1é”æˆã«ã¯æœ€ä½3ã‚±ãƒ¼ã‚¹å¿…è¦:
// 1. Status == Draft && Sections > 0  â†’ æˆåŠŸ
// 2. Status != Draft                  â†’ åˆ†å²1ã§ã‚¨ãƒ©ãƒ¼
// 3. Sections == 0                    â†’ åˆ†å²2ã§ã‚¨ãƒ©ãƒ¼
```

---

## ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰

### ğŸ”º ç†æƒ³çš„ãªãƒ†ã‚¹ãƒˆæ§‹æˆ

```
            â–²
           /E2E\              å°‘ãªã„ï¼ˆ5-10%ï¼‰
          /â”€â”€â”€â”€â”€\             é…ã„ã€å£Šã‚Œã‚„ã™ã„
         /       \            ä¸»è¦ãƒ•ãƒ­ãƒ¼ã®ã¿
        / Integra-\
       /   tion    \          ä¸­ç¨‹åº¦ï¼ˆ20-30%ï¼‰
      /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\         DBé€£æºã®æ¤œè¨¼
     /               \
    /    Unit Test    \       å¤šã„ï¼ˆ60-70%ï¼‰
   /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\      é€Ÿã„ã€å®‰å®š
  /                     \     ãƒ­ã‚¸ãƒƒã‚¯ã®æ¤œè¨¼
```

### ãªãœãƒ”ãƒ©ãƒŸãƒƒãƒ‰å‹ï¼Ÿ

```
âŒ ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ã‚³ãƒ¼ãƒ³å‹ï¼ˆã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰

        â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
       â–“ E2E Test  â–“     â† å¤šã™ãï¼é…ã„ã€å£Šã‚Œã‚„ã™ã„
        â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
           â–“â–“â–“
          â–“ Int â–“         â† å°‘ãªã„
           â–“â–“â–“
            â–“
           â–“Unitâ–“         â† å°‘ãªã™ãï¼
            â–“

å•é¡Œ:
â”œâ”€ E2EãŒå¤šã„ã¨å®Ÿè¡Œæ™‚é–“ãŒé•·ã„ï¼ˆ30åˆ†ä»¥ä¸Šï¼‰
â”œâ”€ ç’°å¢ƒä¾å­˜ã§ä¸å®‰å®šï¼ˆCIå¤±æ•—ãŒé »ç™ºï¼‰
â”œâ”€ ãƒ‡ãƒãƒƒã‚°ãŒå›°é›£ï¼ˆã©ã“ã§å¤±æ•—ã—ãŸã‹ã‚ã‹ã‚‰ãªã„ï¼‰
â””â”€ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆãŒé«˜ã„
```

```
âœ… ãƒ”ãƒ©ãƒŸãƒƒãƒ‰å‹ï¼ˆæ¨å¥¨ï¼‰

            â–²
           /E2E\              â† å°‘æ•°ï¼ˆä¸»è¦ãƒ•ãƒ­ãƒ¼ï¼‰
          /â”€â”€â”€â”€â”€\
         / Integra-\          â† ä¸­ç¨‹åº¦
        /   tion    \
       /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
      /    Unit Test  \       â† å¤šæ•°ï¼ˆé«˜é€Ÿï¼‰
     /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\

ãƒ¡ãƒªãƒƒãƒˆ:
â”œâ”€ å®Ÿè¡Œæ™‚é–“ãŒçŸ­ã„ï¼ˆæ•°åˆ†ï¼‰
â”œâ”€ å®‰å®šã—ã¦ã„ã‚‹ï¼ˆç’°å¢ƒä¾å­˜ãŒå°‘ãªã„ï¼‰
â”œâ”€ ãƒ‡ãƒãƒƒã‚°ã—ã‚„ã™ã„ï¼ˆå¤±æ•—ç®‡æ‰€ãŒæ˜ç¢ºï¼‰
â””â”€ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆãŒä½ã„
```

---

## Clean Architectureã§ã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ğŸ—ï¸ ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥ãƒ†ã‚¹ãƒˆæ–¹é‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Clean Architecture ãƒ†ã‚¹ãƒˆæˆ¦ç•¥                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Unit Testï¼ˆãƒ¢ãƒƒã‚¯ä½¿ç”¨ï¼‰                                 â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  Domainå±¤        âœ… å¿…é ˆ   ç´”ç²‹ãªãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«          â”‚   â”‚
â”‚  â”‚  UseCaseå±¤       âœ… å¿…é ˆ   ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®æµã‚Œ        â”‚   â”‚
â”‚  â”‚  Controllerå±¤    âœ… å¿…é ˆ   ãƒã‚¤ãƒ³ãƒ‰ã€å¤‰æ›ã€ã‚¨ãƒ©ãƒ¼        â”‚   â”‚
â”‚  â”‚  Presenterå±¤     âœ… æ¨å¥¨   Domainâ†’OpenAPIå¤‰æ›           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Integration Testï¼ˆtestcontainers-goï¼‰                   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  Repositoryå±¤    âœ… å¿…é ˆ   SQLã®æ­£ã—ã•ã€DBåˆ¶ç´„           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  E2E Testï¼ˆtestcontainers-goï¼‰                           â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  APIå…¨ä½“         âœ… ä¸»è¦ãƒ•ãƒ­ãƒ¼   èªè¨¼â†’CRUDâ†’ã‚¨ãƒ©ãƒ¼        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Š ã¾ã¨ã‚è¡¨

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | Unit Test | Integration Test | E2E | ãƒ†ã‚¹ãƒˆå†…å®¹ |
|---------|-----------|------------------|-----|-----------|
| **Domain** | âœ… å¿…é ˆ | âŒ | - | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€çŠ¶æ…‹é·ç§» |
| **UseCase** | âœ… å¿…é ˆ | âŒ | - | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰ |
| **Controller** | âœ… å¿…é ˆ | âŒ | - | ãƒã‚¤ãƒ³ãƒ‰ã€å¤‰æ›ã€ã‚¨ãƒ©ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚° |
| **Presenter** | âœ… æ¨å¥¨ | âŒ | - | Domainâ†’OpenAPIå¤‰æ› |
| **Repository** | âš ï¸ é™å®šçš„ | âœ… å¿…é ˆ | - | SQLã€DBåˆ¶ç´„ï¼ˆtestcontainersï¼‰ |
| **APIå…¨ä½“** | - | - | âœ… ä¸»è¦ãƒ•ãƒ­ãƒ¼ | èªè¨¼â†’CRUD |

---

## å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ†ã‚¹ãƒˆè©³ç´°

### 1ï¸âƒ£ Domainå±¤ã®ãƒ†ã‚¹ãƒˆ

**ç›®çš„**: ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‹æ¤œè¨¼

**ç‰¹å¾´**:
- å¤–éƒ¨ä¾å­˜ãªã—ï¼ˆãƒ¢ãƒƒã‚¯ä¸è¦ï¼‰
- ç´”ç²‹é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ
- è¶…é«˜é€Ÿ

```go
// internal/domain/note/logic_test.go
func TestValidateNoteForPublish(t *testing.T) {
    tests := []struct {
        name    string
        note    note.Note
        wantErr error
    }{
        {
            name: "[Success] å…¬é–‹å¯èƒ½ãªãƒãƒ¼ãƒˆ",
            note: note.Note{
                Status:   note.StatusDraft,
                Sections: []note.Section{{Content: "å†…å®¹ã‚ã‚Š"}},
            },
            wantErr: nil,
        },
        {
            name: "[Fail] æ—¢ã«å…¬é–‹æ¸ˆã¿",
            note: note.Note{
                Status: note.StatusPublish,
            },
            wantErr: domainerr.ErrInvalidStatus,
        },
        {
            name: "[Fail] ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒç©º",
            note: note.Note{
                Status:   note.StatusDraft,
                Sections: []note.Section{},
            },
            wantErr: domainerr.ErrNoSections,
        },
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            err := service.ValidateNoteForPublish(tt.note)
            if err != tt.wantErr {
                t.Errorf("want %v, got %v", tt.wantErr, err)
            }
        })
    }
}
```

---

### 2ï¸âƒ£ UseCaseå±¤ã®ãƒ†ã‚¹ãƒˆ

**ç›®çš„**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®æµã‚ŒãŒæ­£ã—ã„ã‹æ¤œè¨¼

**ç‰¹å¾´**:
- Repositoryã‚’ãƒ¢ãƒƒã‚¯ã§å·®ã—æ›¿ãˆ
- DBã‚¢ã‚¯ã‚»ã‚¹ãªã—ï¼ˆé«˜é€Ÿï¼‰
- ç•°å¸¸ç³»ã‚‚ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„

```go
// internal/usecase/note_interactor_test.go
func TestNoteInteractor_Publish(t *testing.T) {
    tests := []struct {
        name      string
        noteID    string
        ownerID   string
        setupMock func(*mock.MockNoteRepository)
        wantErr   error
    }{
        {
            name:    "[Success] å…¬é–‹æˆåŠŸ",
            noteID:  "note-123",
            ownerID: "owner-123",
            setupMock: func(repo *mock.MockNoteRepository) {
                // GetãŒå‘¼ã°ã‚ŒãŸã‚‰ãƒãƒ¼ãƒˆã‚’è¿”ã™
                repo.EXPECT().
                    Get(gomock.Any(), "note-123").
                    Return(&note.WithMeta{
                        Note: note.Note{
                            ID:      "note-123",
                            OwnerID: "owner-123",
                            Status:  note.StatusDraft,
                        },
                    }, nil)

                // UpdateãŒå‘¼ã°ã‚Œã‚‹
                repo.EXPECT().
                    Update(gomock.Any(), gomock.Any()).
                    Return(&note.Note{Status: note.StatusPublish}, nil)
            },
            wantErr: nil,
        },
        {
            name:    "[Fail] ãƒãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„",
            noteID:  "not-found",
            ownerID: "owner-123",
            setupMock: func(repo *mock.MockNoteRepository) {
                repo.EXPECT().
                    Get(gomock.Any(), "not-found").
                    Return(nil, domainerr.ErrNotFound)
            },
            wantErr: domainerr.ErrNotFound,
        },
        {
            name:    "[Fail] æ‰€æœ‰è€…ãŒé•ã†",
            noteID:  "note-123",
            ownerID: "other-owner",
            setupMock: func(repo *mock.MockNoteRepository) {
                repo.EXPECT().
                    Get(gomock.Any(), "note-123").
                    Return(&note.WithMeta{
                        Note: note.Note{
                            ID:      "note-123",
                            OwnerID: "owner-123",  // é•ã†ã‚ªãƒ¼ãƒŠãƒ¼
                        },
                    }, nil)
            },
            wantErr: domainerr.ErrUnauthorized,
        },
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            ctrl := gomock.NewController(t)
            defer ctrl.Finish()

            mockRepo := mock.NewMockNoteRepository(ctrl)
            mockOutput := presenter.NewNotePresenter()
            tt.setupMock(mockRepo)

            interactor := usecase.NewNoteInteractor(mockRepo, nil, nil, mockOutput)
            err := interactor.Publish(context.Background(), tt.noteID, tt.ownerID)

            if !errors.Is(err, tt.wantErr) {
                t.Errorf("want %v, got %v", tt.wantErr, err)
            }
        })
    }
}
```

---

### 3ï¸âƒ£ Controllerå±¤ã®ãƒ†ã‚¹ãƒˆ

**ç›®çš„**: HTTPå±¤ã®æŒ¯ã‚‹èˆã„ãŒæ­£ã—ã„ã‹æ¤œè¨¼

**ãƒ†ã‚¹ãƒˆå¯¾è±¡**:
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®ãƒã‚¤ãƒ³ãƒ‰
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆownerIDç©ºãƒã‚§ãƒƒã‚¯ç­‰ï¼‰
- OpenAPIå‹â†’Domainå‹ã¸ã®å¤‰æ›
- ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼â†’HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒãƒƒãƒ”ãƒ³ã‚°

```go
// internal/adapter/http/controller/note_controller_test.go
func TestNoteController_Create(t *testing.T) {
    tests := []struct {
        name       string
        body       string
        wantStatus int
        wantBody   string
    }{
        {
            name:       "[Success] ãƒãƒ¼ãƒˆä½œæˆæˆåŠŸ",
            body:       `{"title":"Hello","templateId":"00000000-0000-0000-0000-000000000001","ownerId":"00000000-0000-0000-0000-000000000002"}`,
            wantStatus: http.StatusOK,
        },
        {
            name:       "[Fail] ä¸æ­£ãªJSON",
            body:       `not-json`,
            wantStatus: http.StatusBadRequest,
            wantBody:   "invalid body",
        },
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            // ... ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        })
    }
}

func TestNoteController_Update(t *testing.T) {
    tests := []struct {
        name       string
        body       string
        ownerID    string  // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
        wantStatus int
    }{
        {
            name:       "[Success] æ›´æ–°æˆåŠŸ",
            body:       `{"title":"New","sections":[]}`,
            ownerID:    "owner-123",
            wantStatus: http.StatusOK,
        },
        {
            name:       "[Fail] ownerIDãŒç©º",
            body:       `{"title":"New","sections":[]}`,
            ownerID:    "",  // ç©ºï¼
            wantStatus: http.StatusForbidden,
        },
    }
    // ...
}
```

**ã‚¨ãƒ©ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ**:

```go
// internal/adapter/http/controller/helpers_test.go
func TestHandleError(t *testing.T) {
    tests := []struct {
        name       string
        err        error
        wantStatus int
    }{
        {
            name:       "ErrNotFound â†’ 404",
            err:        domainerr.ErrNotFound,
            wantStatus: http.StatusNotFound,
        },
        {
            name:       "ErrUnauthorized â†’ 403",
            err:        domainerr.ErrUnauthorized,
            wantStatus: http.StatusForbidden,
        },
        {
            name:       "ErrInvalidStatus â†’ 400",
            err:        domainerr.ErrInvalidStatus,
            wantStatus: http.StatusBadRequest,
        },
        {
            name:       "æœªçŸ¥ã®ã‚¨ãƒ©ãƒ¼ â†’ 500",
            err:        errors.New("unknown"),
            wantStatus: http.StatusInternalServerError,
        },
    }
    // ...
}
```

---

### 4ï¸âƒ£ Presenterå±¤ã®ãƒ†ã‚¹ãƒˆ

**ç›®çš„**: Domainå‹â†’OpenAPIå‹ã®å¤‰æ›ãŒæ­£ã—ã„ã‹æ¤œè¨¼

```go
// internal/adapter/http/presenter/note_presenter_test.go
func TestNotePresenter_PresentNote(t *testing.T) {
    tests := []struct {
        name     string
        input    note.WithMeta
        expected openapi.ModelsNoteResponse
    }{
        {
            name: "[Success] å¤‰æ›æˆåŠŸ",
            input: note.WithMeta{
                Note: note.Note{
                    ID:     "note-123",
                    Title:  "ãƒ†ã‚¹ãƒˆãƒãƒ¼ãƒˆ",
                    Status: note.StatusDraft,
                },
                TemplateName: "è¨­è¨ˆæ›¸",
            },
            expected: openapi.ModelsNoteResponse{
                Id:           "note-123",
                Title:        "ãƒ†ã‚¹ãƒˆãƒãƒ¼ãƒˆ",
                Status:       openapi.ModelsNoteStatusDraft,
                TemplateName: "è¨­è¨ˆæ›¸",
            },
        },
    }
    // ...
}
```

---

### 5ï¸âƒ£ Repositoryå±¤ã®Integration Test

**ç›®çš„**: SQLãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‹æ¤œè¨¼

**ç‰¹å¾´**:
- testcontainers-goã§å®Ÿéš›ã®PostgreSQLã‚’èµ·å‹•
- DBåˆ¶ç´„ï¼ˆUNIQUEã€FKï¼‰ã®æ¤œè¨¼
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®æ¤œè¨¼

```go
// internal/adapter/gateway/db/sqlc/note_repository_integration_test.go
func TestNoteRepository_Integration(t *testing.T) {
    if testing.Short() {
        t.Skip("skipping integration test")
    }

    // PostgreSQLã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
    pg := testutil.SetupPostgres(t)
    ctx := testutil.TestContext(t) // ãƒ†ã‚¹ãƒˆã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’å°Šé‡ã™ã‚‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ

    // Repositoryä½œæˆ
    pool, _ := pgxpool.New(ctx, pg.ConnectionString)
    defer pool.Close()
    repo := sqlc.NewNoteRepository(pool)

    t.Run("Create and Get", func(t *testing.T) {
        // ä½œæˆ
        created, err := repo.Create(ctx, note.Note{
            Title:      "ãƒ†ã‚¹ãƒˆãƒãƒ¼ãƒˆ",
            TemplateID: "tpl-123",
            OwnerID:    "owner-123",
            Status:     note.StatusDraft,
        })
        assert.NoError(t, err)
        assert.NotEmpty(t, created.ID)

        // å–å¾—
        found, err := repo.Get(ctx, created.ID)
        assert.NoError(t, err)
        assert.Equal(t, "ãƒ†ã‚¹ãƒˆãƒãƒ¼ãƒˆ", found.Note.Title)
    })

    t.Run("Update", func(t *testing.T) {
        // ...
    })

    t.Run("Delete", func(t *testing.T) {
        // ...
    })

    t.Run("NotFound", func(t *testing.T) {
        _, err := repo.Get(ctx, "not-exist")
        assert.ErrorIs(t, err, domainerr.ErrNotFound)
    })
}
```

---

### 6ï¸âƒ£ E2E Test

**ç›®çš„**: å®Ÿéš›ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ãŒå‹•ä½œã™ã‚‹ã‹æ¤œè¨¼

**ç‰¹å¾´**:
- testcontainers-goã§å®Ÿéš›ã®PostgreSQLã‚’èµ·å‹•
- å®Ÿéš›ã®APIã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
- HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãƒ†ã‚¹ãƒˆ

```go
// tests/e2e/note_api_test.go
func TestNoteAPI_E2E(t *testing.T) {
    if testing.Short() {
        t.Skip("skipping e2e test")
    }

    // PostgreSQLã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
    pg := testutil.SetupPostgres(t)

    // APIã‚µãƒ¼ãƒãƒ¼èµ·å‹•
    server := testutil.StartTestServer(t, pg.ConnectionString)
    defer server.Close()

    t.Run("Create â†’ Get â†’ Update â†’ Delete", func(t *testing.T) {
        // 1. ä½œæˆ
        createResp, err := http.Post(
            server.URL+"/api/notes",
            "application/json",
            strings.NewReader(`{
                "title": "E2Eãƒ†ã‚¹ãƒˆ",
                "templateId": "00000000-0000-0000-0000-000000000001",
                "ownerId": "00000000-0000-0000-0000-000000000002"
            }`),
        )
        assert.NoError(t, err)
        assert.Equal(t, http.StatusOK, createResp.StatusCode)

        var created map[string]interface{}
        json.NewDecoder(createResp.Body).Decode(&created)
        noteID := created["id"].(string)

        // 2. å–å¾—
        getResp, err := http.Get(server.URL + "/api/notes/" + noteID)
        assert.NoError(t, err)
        assert.Equal(t, http.StatusOK, getResp.StatusCode)

        // 3. å‰Šé™¤
        deleteReq, _ := http.NewRequest(
            http.MethodDelete,
            server.URL+"/api/notes/"+noteID+"?ownerId=00000000-0000-0000-0000-000000000002",
            nil,
        )
        deleteResp, err := http.DefaultClient.Do(deleteReq)
        assert.NoError(t, err)
        assert.Equal(t, http.StatusOK, deleteResp.StatusCode)
    })

    t.Run("NotFound", func(t *testing.T) {
        resp, _ := http.Get(server.URL + "/api/notes/not-exist")
        assert.Equal(t, http.StatusNotFound, resp.StatusCode)
    })
}
```

---

## testcontainers-goã®ä½¿ã„æ–¹

### ğŸ”„ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ï¼ˆè©³ç´°ï¼‰

Integration Testã¨E2E TestãŒã©ã®ã‚ˆã†ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚

---

#### Integration Test ã®å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  make test-integration                                                  â”‚
â”‚  go test -tags=integration ./internal/adapter/gateway/db/...            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. SetupPostgres(t) - ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  testcontainers-go                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  postgres.Run(ctx,                                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      "postgres:15-alpine",                                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      postgres.WithDatabase("test_db"),                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      postgres.WithUsername("test"),                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      postgres.WithPassword("test"),                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  )                                                           â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                              â”‚                                     â”‚ â”‚
â”‚  â”‚                              â–¼                                     â”‚ â”‚
â”‚  â”‚  Docker API ã§ PostgreSQL ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•                            â”‚ â”‚
â”‚  â”‚  å¾…æ©Ÿ: "database system is ready to accept connections" Ã— 2å›      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. runMigrations() - ã‚¹ã‚­ãƒ¼ãƒä½œæˆ                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  golang-migrate/migrate                                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  migrate.New(                                                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      "file://../../migrations",   â† SQLãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      connStr,                     â† ã‚³ãƒ³ãƒ†ãƒŠã®æ¥ç¶šæ–‡å­—åˆ—      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  )                                                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  m.Up()                           â† å…¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ    â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                              â”‚                                     â”‚ â”‚
â”‚  â”‚                              â–¼                                     â”‚ â”‚
â”‚  â”‚  migrations/                                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ 000001_create_accounts.up.sql    â†’ CREATE TABLE accounts     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ 000002_create_templates.up.sql   â†’ CREATE TABLE templates    â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ 000003_create_fields.up.sql      â†’ CREATE TABLE fields       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ 000004_create_notes.up.sql       â†’ CREATE TABLE notes        â”‚ â”‚
â”‚  â”‚  â””â”€â”€ 000005_create_sections.up.sql    â†’ CREATE TABLE sections     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. CreateTestData() - ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆSeedingï¼‰                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  tests/testutil/fixtures.go                                        â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  CreateTestAccount(t, pool, TestAccount{...})                      â”‚ â”‚
â”‚  â”‚      â†’ INSERT INTO accounts (id, email, first_name, ...) VALUES    â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  CreateTestTemplate(t, pool, TestTemplate{...})                    â”‚ â”‚
â”‚  â”‚      â†’ INSERT INTO templates (id, name, owner_id) VALUES           â”‚ â”‚
â”‚  â”‚      â†’ INSERT INTO fields (id, template_id, label, ...) VALUES     â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  CreateTestNote(t, pool, TestNote{...})                            â”‚ â”‚
â”‚  â”‚      â†’ INSERT INTO notes (id, title, template_id, ...) VALUES      â”‚ â”‚
â”‚  â”‚      â†’ INSERT INTO sections (id, note_id, field_id, ...) VALUES    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè¡Œ                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  repo := sqlc.NewNoteRepository(pool)                              â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  t.Run("Create", func(t *testing.T) {                              â”‚ â”‚
â”‚  â”‚      note, err := repo.Create(ctx, note.Note{...})                 â”‚ â”‚
â”‚  â”‚      assert.NoError(t, err)                                        â”‚ â”‚
â”‚  â”‚  })                                                                â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  t.Run("Get", func(t *testing.T) {                                 â”‚ â”‚
â”‚  â”‚      found, err := repo.Get(ctx, noteID)                           â”‚ â”‚
â”‚  â”‚      assert.Equal(t, expected, found)                              â”‚ â”‚
â”‚  â”‚  })                                                                â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  t.Run("NotFound", func(t *testing.T) {                            â”‚ â”‚
â”‚  â”‚      _, err := repo.Get(ctx, "not-exist")                          â”‚ â”‚
â”‚  â”‚      assert.ErrorIs(t, err, domainerr.ErrNotFound)                 â”‚ â”‚
â”‚  â”‚  })                                                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. t.Cleanup() - è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ãƒ†ã‚¹ãƒˆçµ‚äº†æ™‚ã«è‡ªå‹•å®Ÿè¡Œ:                                            â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  1. pool.Close()           â† DBæ¥ç¶šãƒ—ãƒ¼ãƒ«ã‚’é–‰ã˜ã‚‹                   â”‚ â”‚
â”‚  â”‚  2. pgContainer.Terminate() â† Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤                  â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  â€» ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚‚ã‚³ãƒ³ãƒ†ãƒŠã¨ä¸€ç·’ã«æ¶ˆãˆã‚‹ï¼ˆã‚¯ãƒªãƒ¼ãƒ³ãªçŠ¶æ…‹ï¼‰           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### E2E Test ã®å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  make test-e2e                                                          â”‚
â”‚  go test -tags=e2e ./tests/e2e/...                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. SetupPostgres(t) - ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹• + ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³                    â”‚
â”‚  ï¼ˆIntegration Testã¨åŒã˜ï¼‰                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. StartTestServer(t, connStr) - APIã‚µãƒ¼ãƒãƒ¼èµ·å‹•                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  tests/e2e/testutil/server.go                                      â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  // DBæ¥ç¶šãƒ—ãƒ¼ãƒ«ä½œæˆ                                                â”‚ â”‚
â”‚  â”‚  pool, _ := pgxpool.New(ctx, connStr)                              â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  // Echoã‚µãƒ¼ãƒãƒ¼æ§‹ç¯‰ï¼ˆæœ¬ç•ªã¨åŒã˜ä¾å­˜æ€§æ³¨å…¥ï¼‰                         â”‚ â”‚
â”‚  â”‚  e := buildEchoServer(pool)                                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  buildEchoServer(pool):                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  // Repository Factory                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  accountRepoFactory := factory.NewAccountRepoFactory(pool)   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  templateRepoFactory := factory.NewTemplateRepoFactory(pool) â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  noteRepoFactory := factory.NewNoteRepoFactory(pool)         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  // Controlleræ§‹ç¯‰                                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  nc := httpcontroller.NewNoteController(...)                 â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  tc := httpcontroller.NewTemplateController(...)             â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  // OpenAPIãƒãƒ³ãƒ‰ãƒ©ç™»éŒ²                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  openapi.RegisterHandlers(e, server)                         â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  // ãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ãƒãƒ¼ãƒˆï¼‰                             â”‚ â”‚
â”‚  â”‚  server := httptest.NewServer(e)                                   â”‚ â”‚
â”‚  â”‚  // â†’ http://127.0.0.1:xxxxx ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¯èƒ½                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. CreateDefaultTestData(t, pool) - ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  // E2Eç”¨ã®åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ                                         â”‚ â”‚
â”‚  â”‚  data := testutil.CreateDefaultTestData(t, server.Pool())          â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  â†’ Account (ID, Email, FirstName, LastName)                        â”‚ â”‚
â”‚  â”‚  â†’ Template (ID, Name, OwnerID, Fields[3])                         â”‚ â”‚
â”‚  â”‚  â†’ Note (ID, Title, TemplateID, OwnerID, Sections[3])              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  t.Run("POST /api/notes - Create", func(t *testing.T) {            â”‚ â”‚
â”‚  â”‚      resp, _ := http.Post(                                         â”‚ â”‚
â”‚  â”‚          server.URL + "/api/notes",                                â”‚ â”‚
â”‚  â”‚          "application/json",                                       â”‚ â”‚
â”‚  â”‚          strings.NewReader(`{                                      â”‚ â”‚
â”‚  â”‚              "title": "E2E Test Note",                             â”‚ â”‚
â”‚  â”‚              "templateId": "...",                                  â”‚ â”‚
â”‚  â”‚              "ownerId": "...",                                     â”‚ â”‚
â”‚  â”‚              "sections": [...]                                     â”‚ â”‚
â”‚  â”‚          }`),                                                      â”‚ â”‚
â”‚  â”‚      )                                                             â”‚ â”‚
â”‚  â”‚      require.Equal(t, http.StatusOK, resp.StatusCode)              â”‚ â”‚
â”‚  â”‚  })                                                                â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æµã‚Œï¼ˆæœ¬ç•ªã¨åŒã˜ï¼‰:                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  HTTP Request                                                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚       â†“                                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Echo Router (openapi.RegisterHandlers)                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚       â†“                                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  NoteController.Create()                                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚       â†“                                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  NoteInteractor.Create()                                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚       â†“                                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  NoteRepository.Create() â†’ PostgreSQL (testcontainer)        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚       â†“                                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  NotePresenter â†’ JSON Response                               â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. t.Cleanup() - è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. server.Close()          â† HTTPãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ã‚’åœæ­¢              â”‚ â”‚
â”‚  â”‚  2. pool.Close()            â† DBæ¥ç¶šãƒ—ãƒ¼ãƒ«ã‚’é–‰ã˜ã‚‹                  â”‚ â”‚
â”‚  â”‚  3. pgContainer.Terminate() â† Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### ã‚³ãƒ¼ãƒ‰æ§‹æˆã¨ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²

```
tests/
â”œâ”€â”€ testutil/                         # å…±é€šãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ postgres.go                   # PostgreSQLã‚³ãƒ³ãƒ†ãƒŠç®¡ç†
â”‚   â”‚   â”œâ”€â”€ SetupPostgres(t)          # ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹• + ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”‚   â”œâ”€â”€ NewPool(t)                # pgxpool.Pool ä½œæˆ
â”‚   â”‚   â”œâ”€â”€ runMigrations()           # golang-migrate å®Ÿè¡Œ
â”‚   â”‚   â”œâ”€â”€ getMigrationsPath()       # migrations/ ã®çµ¶å¯¾ãƒ‘ã‚¹å–å¾—
â”‚   â”‚   â””â”€â”€ CleanupTables()           # ãƒ†ãƒ¼ãƒ–ãƒ« TRUNCATEï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
â”‚   â”‚
â”‚   â””â”€â”€ fixtures.go                   # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
â”‚       â”œâ”€â”€ CreateTestAccount()       # INSERT accounts
â”‚       â”œâ”€â”€ CreateTestTemplate()      # INSERT templates + fields
â”‚       â”œâ”€â”€ CreateTestNote()          # INSERT notes + sections
â”‚       â””â”€â”€ CreateDefaultTestData()   # ä¸€æ‹¬ä½œæˆï¼ˆE2Eç”¨ï¼‰
â”‚
â””â”€â”€ e2e/                              # E2Eãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ testutil/
    â”‚   â””â”€â”€ server.go                 # ãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼èµ·å‹•
    â”‚       â”œâ”€â”€ StartTestServer()     # httptest.Server èµ·å‹•
    â”‚       â”œâ”€â”€ buildEchoServer()     # ä¾å­˜æ€§æ³¨å…¥æ¸ˆã¿Echoæ§‹ç¯‰
    â”‚       â””â”€â”€ Pool()                # DBæ¥ç¶šãƒ—ãƒ¼ãƒ«å–å¾—
    â”‚
    â”œâ”€â”€ note_api_test.go              # Note API ãƒ†ã‚¹ãƒˆ
    â””â”€â”€ template_api_test.go          # Template API ãƒ†ã‚¹ãƒˆ
```

---

#### ãªãœã“ã®è¨­è¨ˆã«ã—ãŸã‹ï¼Ÿ

```
1. ãƒ†ã‚¹ãƒˆã®ç‹¬ç«‹æ€§
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  å„ãƒ†ã‚¹ãƒˆã§æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•                         â”‚
   â”‚  â†’ ãƒ†ã‚¹ãƒˆé–“ã§ãƒ‡ãƒ¼ã‚¿ãŒå¹²æ¸‰ã—ãªã„                         â”‚
   â”‚  â†’ ä¸¦åˆ—å®Ÿè¡Œã—ã¦ã‚‚å®‰å…¨                                   â”‚
   â”‚  â†’ å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®ãƒ‡ãƒãƒƒã‚°ãŒã—ã‚„ã™ã„                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. æœ¬ç•ªã¨åŒã˜ã‚¹ã‚­ãƒ¼ãƒ
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  migrations/ ã® SQL ã‚’ãã®ã¾ã¾ä½¿ç”¨                      â”‚
   â”‚  â†’ æœ¬ç•ªã¨ãƒ†ã‚¹ãƒˆã®ã‚¹ã‚­ãƒ¼ãƒå·®ç•°ãŒãªã„                     â”‚
   â”‚  â†’ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ æ™‚ã‚‚è‡ªå‹•ã§åæ˜                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. t.Cleanup() ã«ã‚ˆã‚‹è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  ãƒ†ã‚¹ãƒˆçµ‚äº†æ™‚ã«è‡ªå‹•ã§ã‚³ãƒ³ãƒ†ãƒŠå‰Šé™¤                       â”‚
   â”‚  â†’ defer ã‚ˆã‚Šç¢ºå®Ÿï¼ˆpanicã—ã¦ã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ï¼‰              â”‚
   â”‚  â†’ ãƒªã‚½ãƒ¼ã‚¹ãƒªãƒ¼ã‚¯ã®å¿ƒé…ãªã—                             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. E2Eã¯æœ¬ç•ªã¨åŒã˜ä¾å­˜æ€§æ³¨å…¥
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  buildEchoServer() ã§æœ¬ç•ªã¨åŒã˜æ§‹æˆ                     â”‚
   â”‚  â†’ ãƒ¢ãƒƒã‚¯ãªã—ã€å®Ÿéš›ã®Repositoryä½¿ç”¨                     â”‚
   â”‚  â†’ æœ¬å½“ã«å‹•ä½œã™ã‚‹ã‹ã‚’æ¤œè¨¼                               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ“¦ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
go get github.com/testcontainers/testcontainers-go
go get github.com/testcontainers/testcontainers-go/modules/postgres
```

### ğŸ”§ å…±é€šãƒ˜ãƒ«ãƒ‘ãƒ¼

```go
// tests/testutil/postgres.go
package testutil

import (
    "context"
    "testing"

    "github.com/golang-migrate/migrate/v4"
    _ "github.com/golang-migrate/migrate/v4/database/postgres"
    _ "github.com/golang-migrate/migrate/v4/source/file"
    "github.com/testcontainers/testcontainers-go"
    "github.com/testcontainers/testcontainers-go/modules/postgres"
    "github.com/testcontainers/testcontainers-go/wait"
)

type PostgresContainer struct {
    *postgres.PostgresContainer
    ConnectionString string
}

func SetupPostgres(t *testing.T) *PostgresContainer {
    t.Helper()
    ctx := context.Background() // ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ã¯ãƒ†ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¨ç‹¬ç«‹

    // PostgreSQLã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
    pgContainer, err := postgres.Run(ctx,
        "postgres:15-alpine",
        postgres.WithDatabase("test_db"),
        postgres.WithUsername("test"),
        postgres.WithPassword("test"),
        testcontainers.WithWaitStrategy(
            wait.ForLog("database system is ready to accept connections").
                WithOccurrence(2),
        ),
    )
    if err != nil {
        t.Fatalf("failed to start postgres: %v", err)
    }

    // æ¥ç¶šæ–‡å­—åˆ—å–å¾—
    connStr, err := pgContainer.ConnectionString(ctx, "sslmode=disable")
    if err != nil {
        t.Fatalf("failed to get connection string: %v", err)
    }

    // ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
    if err := runMigrations(connStr); err != nil {
        t.Fatalf("failed to run migrations: %v", err)
    }

    // ãƒ†ã‚¹ãƒˆçµ‚äº†æ™‚ã«ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢
    t.Cleanup(func() {
        pgContainer.Terminate(ctx)
    })

    return &PostgresContainer{
        PostgresContainer: pgContainer,
        ConnectionString:  connStr,
    }
}

func runMigrations(connStr string) error {
    m, err := migrate.New(
        "file://../../migrations",
        connStr,
    )
    if err != nil {
        return err
    }
    defer m.Close()

    if err := m.Up(); err != nil && err != migrate.ErrNoChange {
        return err
    }
    return nil
}

// TestContext ã¯ãƒ†ã‚¹ãƒˆã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’å°Šé‡ã™ã‚‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚
// ãƒ†ã‚¹ãƒˆã« -timeout ãƒ•ãƒ©ã‚°ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãã®ãƒ‡ãƒƒãƒ‰ãƒ©ã‚¤ãƒ³ã§
// ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã€DBæ“ä½œãŒãƒãƒ³ã‚°ã™ã‚‹ã®ã‚’é˜²ãã€‚
func TestContext(t *testing.T) context.Context {
    t.Helper()
    ctx, cancel := context.WithCancel(context.Background())
    if deadline, ok := t.Deadline(); ok {
        ctx, cancel = context.WithDeadline(context.Background(), deadline)
    }
    t.Cleanup(cancel)
    return ctx
}
```

### ğŸš€ ãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```go
// tests/testutil/server.go
package testutil

import (
    "net/http/httptest"
    "testing"

    "immortal-architecture-clean/backend/internal/driver/initializer/api"
    basetestutil "immortal-architecture-clean/backend/tests/testutil"
)

func StartTestServer(t *testing.T, dbConnStr string) *httptest.Server {
    t.Helper()
    ctx := basetestutil.TestContext(t)

    // ãƒ†ã‚¹ãƒˆç”¨ã®è¨­å®šã§ã‚µãƒ¼ãƒãƒ¼æ§‹ç¯‰
    e, cleanup, err := api.BuildServerWithDB(ctx, dbConnStr)
    if err != nil {
        t.Fatalf("failed to build server: %v", err)
    }

    // ãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼èµ·å‹•
    server := httptest.NewServer(e)

    t.Cleanup(func() {
        server.Close()
        cleanup()
    })

    return server
}
```

### âš¡ å®Ÿè¡Œæ–¹æ³•

```bash
# Unit Testã®ã¿ï¼ˆé«˜é€Ÿã€Dockerä¸è¦ï¼‰
make test-unit

# Integration Testï¼ˆtestcontainers-goä½¿ç”¨ã€Dockerå¿…é ˆï¼‰
make test-integration

# E2E Testï¼ˆtestcontainers-goä½¿ç”¨ã€Dockerå¿…é ˆï¼‰
make test-e2e

# ç‰¹å®šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
make test-pkg PKG=./internal/domain/note

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
make test-run PKG=./internal/domain/note RUN=TestValidateNoteForCreate

# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆUnit + Integration + E2Eï¼‰
# â€» DockerãŒå¿…è¦
go test -tags=integration,e2e ./...
```

**è£œè¶³:**
- `make test-unit`: ãƒ¢ãƒƒã‚¯ã‚’ä½¿ã£ãŸUnit Testã®ã¿ï¼ˆé«˜é€Ÿã€Dockerä¸è¦ï¼‰
- `make test-integration`: Repositoryå±¤ã®Integration Testï¼ˆDockerå¿…é ˆï¼‰
- `make test-e2e`: APIå…¨ä½“ã®E2E Testï¼ˆDockerå¿…é ˆï¼‰

---

## ã‚ˆãã‚ã‚‹è³ªå•

### Q1: Controller + DB ã® Integration Test ã¯å¿…è¦ï¼Ÿ

**A: ä¸è¦ã§ã™ã€‚E2Eã¨é‡è¤‡ã™ã‚‹ã‹ã‚‰ã§ã™ã€‚**

```
ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¼ç¯„å›²:

Controller Unit Test:
  Controller â†’ UseCase(Mock) â†’ Repository(Mock)
  æ¤œè¨¼: ãƒã‚¤ãƒ³ãƒ‰ã€å¤‰æ›ã€ã‚¨ãƒ©ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°

Repository Integration Test:
  Repository â†’ DB(Real)
  æ¤œè¨¼: SQLã€DBåˆ¶ç´„

E2E Test:
  Controller â†’ UseCase â†’ Repository â†’ DB
  æ¤œè¨¼: å…¨ä½“ã®æµã‚Œ

Controller Integration Testï¼ˆä¸è¦ï¼‰:
  Controller â†’ UseCase â†’ Repository â†’ DB
  æ¤œè¨¼: ??? â† E2Eã¨åŒã˜ï¼
```

---

### Q2: Unit Testã¨Integration Testã®ä½¿ã„åˆ†ã‘ã¯ï¼Ÿ

**A: ã€Œä½•ã‚’æ¤œè¨¼ã—ãŸã„ã‹ã€ã§æ±ºã‚ã¾ã™ã€‚**

```
ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ¤œè¨¼ã—ãŸã„:
  â†’ Unit Testï¼ˆãƒ¢ãƒƒã‚¯ä½¿ç”¨ï¼‰
  â†’ é€Ÿã„ã€å®‰å®šã€ãƒ‡ãƒãƒƒã‚°ã—ã‚„ã™ã„

DBã¨ã®é€£æºã‚’æ¤œè¨¼ã—ãŸã„:
  â†’ Integration Testï¼ˆtestcontainers-goï¼‰
  â†’ SQLã€åˆ¶ç´„ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³
```

---

### Q3: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¯ã©ã†ç”¨æ„ã™ã‚‹ï¼Ÿ

**A: 3ã¤ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚**

```
1. ãƒ†ã‚¹ãƒˆå†…ã§ä½œæˆï¼ˆæ¨å¥¨ï¼‰
   å„ãƒ†ã‚¹ãƒˆã§å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’CREATE
   â†’ ãƒ†ã‚¹ãƒˆé–“ã®ä¾å­˜ãŒãªã„ã€ã‚ã‹ã‚Šã‚„ã™ã„

2. ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ãƒ•ã‚¡ã‚¤ãƒ«
   tests/fixtures/seeds.sql ã‚’ç”¨æ„
   â†’ å…±é€šãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ‹¬æŠ•å…¥

3. ãƒ•ã‚¡ã‚¯ãƒˆãƒªé–¢æ•°
   testutil.CreateNote(t, repo, ...) ã®ã‚ˆã†ãªé–¢æ•°
   â†’ å†åˆ©ç”¨ã—ã‚„ã™ã„
```

---

### Q4: ãƒ†ã‚¹ãƒˆãŒé…ã„ã¨ãã¯ã©ã†ã™ã‚‹ï¼Ÿ

**A: ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚**

```
1. testcontainersã®å†åˆ©ç”¨
   åŒã˜ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å†…ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’å…±æœ‰

2. ä¸¦åˆ—å®Ÿè¡Œ
   t.Parallel() ã‚’ä½¿ç”¨

3. -short ãƒ•ãƒ©ã‚°
   Integration Testã‚’ã‚¹ã‚­ãƒƒãƒ—

4. ãƒ†ã‚¹ãƒˆã®ç²’åº¦ã‚’è¦‹ç›´ã™
   E2EãŒå¤šã™ããªã„ã‹ç¢ºèª
```

---

### Q5: ãƒ¢ãƒƒã‚¯ã¨ã‚¹ã‚¿ãƒ–ã®é•ã„ã¯ï¼Ÿ

**A:**

```
ã‚¹ã‚¿ãƒ–ï¼ˆStubï¼‰:
  å›ºå®šå€¤ã‚’è¿”ã™ã ã‘
  ã€Œã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã°ã‚ŒãŸã‚‰ã“ã‚Œã‚’è¿”ã™ã€

ãƒ¢ãƒƒã‚¯ï¼ˆMockï¼‰:
  å‘¼ã³å‡ºã—ã‚’æ¤œè¨¼ã§ãã‚‹
  ã€Œã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒ1å›å‘¼ã°ã‚ŒãŸã‹ç¢ºèªã€
  ã€Œå¼•æ•°ãŒã“ã®å€¤ã‹ç¢ºèªã€

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯gomockã‚’ä½¿ç”¨:
  â†’ ã‚¹ã‚¿ãƒ–ã¨ã—ã¦ã‚‚ãƒ¢ãƒƒã‚¯ã¨ã—ã¦ã‚‚ä½¿ãˆã‚‹
```

---

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
backend-clean/
â”œâ”€ internal/
â”‚   â”œâ”€ domain/
â”‚   â”‚   â””â”€ note/
â”‚   â”‚       â”œâ”€ entity.go
â”‚   â”‚       â””â”€ entity_test.go              # Unit Test
â”‚   â”‚
â”‚   â”œâ”€ usecase/
â”‚   â”‚   â”œâ”€ note_interactor.go
â”‚   â”‚   â”œâ”€ note_interactor_test.go         # Unit Test
â”‚   â”‚   â””â”€ mock/                           # gomockç”Ÿæˆ
â”‚   â”‚
â”‚   â””â”€ adapter/
â”‚       â”œâ”€ http/
â”‚       â”‚   â”œâ”€ controller/
â”‚       â”‚   â”‚   â”œâ”€ note_controller.go
â”‚       â”‚   â”‚   â”œâ”€ note_controller_test.go # Unit Test
â”‚       â”‚   â”‚   â””â”€ mock/
â”‚       â”‚   â””â”€ presenter/
â”‚       â”‚       â”œâ”€ note_presenter.go
â”‚       â”‚       â””â”€ note_presenter_test.go  # Unit Test
â”‚       â”‚
â”‚       â””â”€ gateway/
â”‚           â””â”€ db/
â”‚               â””â”€ sqlc/
â”‚                   â”œâ”€ note_repository.go
â”‚                   â””â”€ note_repository_integration_test.go  # Integration
â”‚
â”œâ”€ tests/
â”‚   â”œâ”€ e2e/
â”‚   â”‚   â””â”€ note_api_test.go                # E2E Test
â”‚   â”‚
â”‚   â””â”€ testutil/
â”‚       â”œâ”€ postgres.go                     # testcontainers-go
â”‚       â””â”€ server.go                       # ãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼
â”‚
â””â”€ migrations/                             # DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
```

---

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **Unit Testã‚’æ›¸ã„ã¦ã¿ã‚‹**
   - Domainå±¤ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰å§‹ã‚ã‚‹
   - ãƒ†ãƒ¼ãƒ–ãƒ«é§†å‹•ãƒ†ã‚¹ãƒˆã§æ›¸ã

2. **Integration Testã‚’æ›¸ã„ã¦ã¿ã‚‹**
   - testcontainers-goã§PostgreSQLã‚’èµ·å‹•
   - Repositoryã®CRUDã‚’ãƒ†ã‚¹ãƒˆ

3. **E2E Testã‚’æ›¸ã„ã¦ã¿ã‚‹**
   - ä¸»è¦ãªAPIãƒ•ãƒ­ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ
   - èªè¨¼â†’ä½œæˆâ†’å–å¾—â†’å‰Šé™¤

**Happy Testing!** ğŸ‰
